{% extends "base.html" %}
{% block title %}{{ config.TITLE }}{% endblock %}
{% block content %}
<div class="mt-4">
    <div class="card">
        <div class="card-header">
            <h4>{{ translate('Manage Events') }}</h4>
            <div class="d-flex justify-content-end">
                <a href="/create_event" class="btn btn-light px-5"><i class="icon-plus"></i> {{ translate('Create Event') }}</a>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th scope="col">{{ translate('Event Title') }}</th>
                            <th scope="col">{{ translate('Club') }}</th>
                            <th scope="col">{{ translate('Event Date') }}</th>
                            <th scope="col">{{ translate('Type') }}</th>
                            <th scope="col">{{ translate('Players') }}</th>
                            <th scope="col">{{ translate('Status') }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in result %}
                        <tr onclick="window.location.href='{{ url_for('views.edit_event_step1', event_id=event.ev_id) }}';" style="cursor: pointer;">
                            <td>
                                <strong>{{ event.ev_title }}</strong><br>
                                <small class="text-muted">{{ event.ev_location }}</small>
                            </td>
                            <td>{{ event.club.cl_name }}</td>
                            <td>
                                {{ event.ev_date.strftime('%Y-%m-%d') }}<br>
                                <small>{{ event.ev_start_time.strftime('%H:%M') }}</small>
                            </td>
                            <td>
                                {% if event.event_type and event.event_type.et_name == 'NonStop' %}
                                    <span class="badge badge-info">{{ translate('Non-Stop') }}</span>
                                {% elif event.event_type and event.event_type.et_name == 'Americano' %}
                                    <span class="badge badge-success">{{ translate('Americano') }}</span>
                                {% elif event.event_type and event.event_type.et_name == 'Mexicano' %}
                                    <span class="badge badge-warning">{{ translate('Mexicano') }}</span>
                                {% else %}
                                    <span class="badge badge-secondary">{{ event.event_type.et_name if event.event_type else 'Unknown' }}</span>
                                {% endif %}
                            </td>
                            <td>{{ event.registrations|length }} / {{ event.ev_max_players }}</td>
                            <td>
                                {% set regular_players = event.registrations|selectattr('er_is_substitute', 'equalto', false)|list|length %}
                                {% set substitute_players = event.registrations|selectattr('er_is_substitute', 'equalto', true)|list|length %}
                                {% set total_registrations = event.registrations|length %}
                                
                                {% if event.ev_status == 'event_started' %}
                                    <span class="badge badge-info">{{ translate('In Progress') }}</span>
                                {% elif event.ev_status == 'event_ended' %}
                                    <span class="badge badge-dark">{{ translate('Completed') }}</span>
                                {% elif event.ev_status == 'canceled' %}
                                    <span class="badge badge-danger">{{ translate('Canceled') }}</span>
                                {% elif regular_players >= event.ev_max_players and substitute_players > 0 %}
                                    <span class="badge badge-danger">{{ translate('Full (with Substitutes)') }}</span>
                                {% elif regular_players >= event.ev_max_players %}
                                    <span class="badge badge-warning">{{ translate('Full') }}</span>
                                {% elif event.ev_status == 'registration_started' or (event.ev_status == 'announced' and total_registrations > 0) %}
                                    <span class="badge badge-success">{{ translate('Registration Open') }}</span>
                                {% elif event.ev_status == 'registration_ended' %}
                                    <span class="badge badge-warning">{{ translate('Registration Closed') }}</span>
                                {% elif event.ev_status == 'announced' %}
                                    <span class="badge badge-secondary">{{ translate('Announced') }}</span>
                                {% else %}
                                    <span class="badge badge-light">{{ event.ev_status }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="text-center">
                                <p class="mb-0">{{ translate('No events found') }}</p>
                                <small class="text-muted">{{ translate('Create your first event to get started') }}</small>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}