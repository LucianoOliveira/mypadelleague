{% extends 'base.html' %}
{% block content %}
<div class="mt-4">
    <div class="card">
        <div class="card-header">
            <h4>{{ translate('Edit Event') if is_edit else translate('Create Mexican Tournament') }}</h4>
            <p class="mb-0 text-muted">{{ translate('Step 2: Number of Players') }}</p>
            
            <!-- Progress indicators -->
            <div class="mt-3">
                <div class="progress" style="height: 8px;">
                    <div class="progress-bar bg-success" style="width: 40%"></div>
                </div>
                <small class="text-muted">{{ translate('Step 2 of 5') }}</small>
            </div>
        </div>
        <div class="card-body">
            {% if is_edit %}
            <form action="{{ url_for('views.edit_event_public_step_players', event_id=event_id, code=access_code) }}" method="post" id="playersForm">
            {% else %}
            <form action="{{ url_for('views.create_event_step_players') }}" method="post" id="playersForm">
            {% endif %}
                
                <!-- Mexican Tournament Explanation -->
                <div class="alert alert-info">
                    <h6><i class="zmdi zmdi-info-outline"></i> {{ translate('Mexican Tournament') }}</h6>
                    <p class="mb-0">{{ translate('Players will be paired dynamically each round, may repeat pairings and opponents. Perfect for mixing up the competition!') }}</p>
                </div>
                
                <h5 class="mb-3">{{ translate('How many players will participate?') }}</h5>
                
                <div class="form-group">
                    <label for="max_players">{{ translate('Number of Players') }} <span class="text-danger">*</span></label>
                    <select class="form-control form-control-lg" id="max_players" name="max_players" required>
                        <option value="">{{ translate('Select number of players') }}...</option>
                        <option value="8" {% if current_max_players == 8 %}selected{% endif %}>8 {{ translate('players') }} (2 {{ translate('courts') }})</option>
                        <option value="12" {% if current_max_players == 12 %}selected{% endif %}>12 {{ translate('players') }} (3 {{ translate('courts') }})</option>
                        <option value="16" {% if current_max_players == 16 %}selected{% endif %}>16 {{ translate('players') }} (4 {{ translate('courts') }})</option>
                        <option value="20" {% if current_max_players == 20 %}selected{% endif %}>20 {{ translate('players') }} (5 {{ translate('courts') }})</option>
                        <option value="24" {% if current_max_players == 24 %}selected{% endif %}>24 {{ translate('players') }} (6 {{ translate('courts') }})</option>
                        <option value="28" {% if current_max_players == 28 %}selected{% endif %}>28 {{ translate('players') }} (7 {{ translate('courts') }})</option>
                        <option value="32" {% if current_max_players == 32 %}selected{% endif %}>32 {{ translate('players') }} (8 {{ translate('courts') }})</option>
                    </select>
                    <small class="form-text text-muted">{{ translate('Must be a multiple of 4 (minimum 8 players)') }}</small>
                </div>
                
                <!-- Player count visualization -->
                <div class="mt-4" id="player-visualization" style="display: none;">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6>{{ translate('Tournament Setup') }}</h6>
                            <div class="row text-center">
                                <div class="col-md-6">
                                    <div class="text-center">
                                        <i class="zmdi zmdi-accounts text-primary" style="font-size: 2.5rem;"></i>
                                        <div><strong id="selected-players">0</strong> {{ translate('Players') }}</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-center">
                                        <i class="zmdi zmdi-home text-success" style="font-size: 2.5rem;"></i>
                                        <div><strong id="required-courts">0</strong> {{ translate('Courts') }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3 alert alert-light text-center">
                                <small class="text-muted">
                                    <i class="zmdi zmdi-info"></i>
                                    {{ translate('Mexican tournaments have unlimited rounds - play as long as you want!') }}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="row mt-4">
                    <div class="col-md-6 mb-3">
                        {% if is_edit %}
                        <a href="{{ url_for('views.edit_event_public_step_basic', event_id=event_id, code=access_code) }}" class="btn btn-secondary btn-block">
                            <i class="zmdi zmdi-arrow-left"></i> {{ translate('Back to Basic Info') }}
                        </a>
                        {% else %}
                        <a href="{{ url_for('views.create_event_public_form', event_type_id=event_type.et_id) }}" class="btn btn-secondary btn-block">
                            <i class="zmdi zmdi-arrow-left"></i> {{ translate('Back to Basic Info') }}
                        </a>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <button type="submit" class="btn btn-primary btn-block" id="nextBtn" {{ '' if is_edit and current_max_players else 'disabled' }}>
                            <i class="zmdi zmdi-arrow-right"></i> {{ translate('Next: Pairing Method') }}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const playersSelect = document.getElementById('max_players');
    const nextBtn = document.getElementById('nextBtn');
    const visualization = document.getElementById('player-visualization');
    
    playersSelect.addEventListener('change', function() {
        const playerCount = parseInt(this.value);
        
        if (playerCount) {
            const courts = playerCount / 4;
            
            document.getElementById('selected-players').textContent = playerCount;
            document.getElementById('required-courts').textContent = courts;
            
            visualization.style.display = 'block';
            nextBtn.disabled = false;
        } else {
            visualization.style.display = 'none';
            nextBtn.disabled = true;
        }
    });
});
</script>

<style>
@media (max-width: 576px) {
    .btn-block {
        width: 100%;
        margin-bottom: 0.5rem;
    }
    
    .form-control-lg {
        font-size: 16px; /* Prevents zoom on iOS */
    }
}

.progress {
    border-radius: 10px;
}

.card-body .row .col-md-4 {
    margin-bottom: 1rem;
}

@media (min-width: 768px) {
    .card-body .row .col-md-4 {
        margin-bottom: 0;
    }
}
</style>

{% endblock %}